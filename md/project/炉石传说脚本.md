# 1 打开炉石传说日志

修改C:/Users/你的用户名/AppData/Local/Blizzard/Hearthstone/log.config文件，改为以下格式，重启游戏就能输出日志了

```tex
[LoadingScreen]
LogLevel=1
FilePrinting=True
ConsolePrinting=False
ScreenPrinting=False
Verbose=False
[Arena]
LogLevel=1
FilePrinting=True
ConsolePrinting=False
ScreenPrinting=False
Verbose=False
[Decks]
LogLevel=1
FilePrinting=True
ConsolePrinting=False
ScreenPrinting=False
Verbose=False
[Achievements]
LogLevel=1
FilePrinting=True
ConsolePrinting=False
ScreenPrinting=False
Verbose=False
[FullScreenFX]
LogLevel=1
FilePrinting=True
ConsolePrinting=False
ScreenPrinting=False
Verbose=False
[Power]
LogLevel=1
FilePrinting=True
ConsolePrinting=False
ScreenPrinting=False
Verbose=True
```



# 2 炉石传说日志位置

位于你的炉石传说安装路径下的Logs文件夹中，每次启动炉石传说会在Logs文件夹下新建一个日志文件夹（Hearthstone_2023_10_04_02_03_11格式），进入后里面会包含各种日志文件



# 3 解读日志

## 3.1 Power.log日志

可以参考这几位老哥的文章 [炉石传说Power.log日志标签含义](https://www.jianshu.com/p/ec785ca58d0a)、[炉石传说Power.log日志解析](https://www.jianshu.com/p/af678d555738)、[炉石日志流程1](https://www.jianshu.com/p/0a255b0bac43)、

[炉石传说LOG日志文件解读及入门教程](https://nga.178.com/read.php?tid=11838545&rand=362)



## 3.2 LoadingScreen日志

```tex
D 15:24:42.1392571 LoadingScreen.OnSceneLoaded() - prevMode=STARTUP currMode=LOGIN
```

主要看上面这行日志，表示上一个模式为STARTUP，当前模式为LOGIN，总共有15个模式，具体的模式可在club.xiaojiawei.strategy.AbstractModeStrategy.ModeEnum枚举类中查看。通过读取LoadingScreen日志便能知道当前处于哪一模式中。



## 3.3 Deck.log日志



# 4 解析日志

其中Power.log日志比较复杂，对此创建了专门的解析器，位于club.xiaojiawei.utils包下的PowerLogUtil。解析器只解析了日志里的SHOW_ENTITY、FULL_ENTITY、CHANGE_ENTITY、TAG_CAHNGE四个标签。PowerLogUtil还提供了main方法用于去除日志中的不重要信息，方便自己查看日志。



# 5 实现套牌策略

1. 在club.xiaojiawei.strategy.deck包下新建套牌类，类名以DeckStrategy结尾
2. 新建的套牌类继承AbstractDeckStrategy类，然后重写executeChangeCard、executeOutCard、executeDiscoverChooseCard这三个方法，这三个方法分别代表着换牌策略、出牌策略、发现选牌策略，AbstractDeckStrategy类包含了许多公共方法供使用。
3. 在club.xiaojiawei.enums.DeckEnum枚举类中添加套牌的枚举常量



# 6 项目结构

.
└── **club**
    └── **xiaojiawei**
        ├── **appender**	//日志追加包：用于将脚本日志发送到JavaFX GUI和web界面中
        │   ├── JavaFXLogAppender.java
        │   └── WsLogAppender.java
        ├── **bean**
        │   ├── **area**	//区域包：游戏里的各种区域，如战场区，手牌区等
        │   │   ├── Area.java
        │   │   ├── DeckArea.java
        │   │   ├── GraveyardArea.java
        │   │   ├── HandArea.java
        │   │   ├── PlayArea.java
        │   │   ├── RemovedfromgameArea.java
        │   │   ├── SecretArea.java
        │   │   └── SetasideArea.java
        │   ├── BaseCard.java
        │   ├── Block.java
        │   ├── Deck.java
        │   ├── **entity**	//实体包：游戏中每张卡牌，每个效果都是一个实体
        │   │   ├── Card.java
        │   │   ├── CommonEntity.java
        │   │   ├── Entity.java
        │   │   ├── ExtraCard.java
        │   │   ├── ExtraEntity.java
        │   │   └── TagChangeEntity.java
        │   ├── Player.java
        │   ├── Release.java
        │   ├── Result.java
        │   └── WsResult.java
        ├── **config**
        │   ├── ConfigurationConfig.java
        │   ├── EnumConfig.java
        │   ├── InitializerConfig.java
        │   ├── LogListenerConfig.java
        │   ├── PauseConfig.java	//记录脚本运行状态，是否暂停
        │   ├── RestTemplateConfig.java
        │   ├── SchedulingRewriteConfig.java
        │   ├── StarterConfig.java
        │   ├── ThreadPoolConfig.java
        │   └── WebSocketConfig.java
        ├── **controller**
        │   ├── JavaFXAdvancedSettingsController.java
        │   ├── JavaFXDashboardController.java
        │   ├── JavaFXInitSettingsController.java
        │   └── WebDashboardController.java
        ├── **core**	//核心包：控制脚本的开始
        │   └── Core.java
        ├── **custom**
        │   ├── DealTagChange.java
        │   ├── **dll**
        │   │   └── User32Dll.java
        │   ├── LogRunnable.java
        │   ├── MouseClickListener.java
        │   └── ParseExtraEntity.java
        ├── **data**
        │   ├── GameRationStaticData.java
        │   ├── ScriptStaticData.java
        │   └── SpringData.java
        ├── **enums**
        │   ├── BlockTypeEnum.java
        │   ├── CardRaceEnum.java
        │   ├── CardTypeEnum.java
        │   ├── ConfigurationEnum.java
        │   ├── DeckEnum.java
        │   ├── DeckTypeEnum.java
        │   ├── HeroTypeEnum.java
        │   ├── ModeEnum.java
        │   ├── MulliganStateEnum.java
        │   ├── PowerTypeEnum.java
        │   ├── RegCommonNameEnum.java
        │   ├── ResultStatusEnum.java
        │   ├── RunModeEnum.java
        │   ├── SpecialCardEnum.java
        │   ├── StageEnum.java
        │   ├── StepEnum.java
        │   ├── TagEnum.java
        │   ├── WarPhaseEnum.java
        │   ├── WsResultTypeEnum.java
        │   └── ZoneEnum.java
        ├── **filter**
        │   └── TokenFilter.java
        ├── **initializer**	//初始化器包：脚本启动后执行初始化器
        │   ├── AbstractInitializer.java
        │   ├── DelTempInitializer.java
        │   ├── LogInitializer.java
        │   ├── PathInitializer.java
        │   └── WebInitializer.java
        ├── **listener**
        │   ├── ExitHotkeyListener.java
        │   ├── **log**	//游戏日志监听包
        │   │   ├── AbstractLogListener.java
        │   │   ├── DeckLogListener.java
        │   │   ├── PowerLogListener.java
        │   │   └── ScreenLogListener.java
        │   ├── PauseHotkeyListener.java
        │   ├── VersionListener.java
        │   └── WarCountListener.java
        ├── ScriptApplication.java
        ├── **starter**	//开始器包：在脚本开始后执行开始器
        │   ├── AbstractStarter.java
        │   ├── ClearStarter.java
        │   ├── GameStarter.java
        │   ├── ListenStarter.java
        │   └── PlatformStarter.java
        ├── **status**
        │   ├── Mode.java
        │   ├── War.java
        │   └── Work.java
        ├── **strategy**	//策略包：用于执行各种策略，包括模式策略、套牌策略、时期策略
        │   ├── AbstractDeckStrategy.java
        │   ├── AbstractModeStrategy.java
        │   ├── AbstractPhaseStrategy.java
        │   ├── **deck**
        │   │   ├── EvenNumberShamanDeckStrategy.java
        │   │   ├── FreeDeckStrategy.java
        │   │   └── ZooDeckStrategy.java
        │   ├── **mode**
        │   │   ├── AdventureModeStrategy.java
        │   │   ├── BaconModeStrategy.java
        │   │   ├── CollectionmanagerModeStrategy.java
        │   │   ├── DraftModeStrategy.java
        │   │   ├── FatalErrorModeStrategy.java
        │   │   ├── GameModeStrategy.java
        │   │   ├── GameplayModeStrategy.java
        │   │   ├── HubModeStrategy.java
        │   │   ├── LettuceMapModeStrategy.java
        │   │   ├── LoginModeStrategy.java
        │   │   ├── PackopeningModeStrategy.java
        │   │   ├── PvpDungeonRunModeStrategy.java
        │   │   ├── StartupModeStrategy.java
        │   │   ├── TavernBrawlModeStrategy.java
        │   │   └── TournamentModeStrategy.java
        │   └── **phase**
        │       ├── DrawnInitCardPhaseStrategy.java
        │       ├── FillDeckPhaseStrategy.java
        │       ├── GameOverPhaseStrategy.java
        │       ├── GameTurnPhaseStrategy.java
        │       ├── ReplaceCardPhaseStrategy.java
        │       └── SpecialEffectTriggerPhaseStrategy.java
        ├── UIApplication.java
        ├── **utils**	//工具包
        │   ├── FrameUtil.java
        │   ├── GameUtil.java
        │   ├── MouseUtil.java
        │   ├── PowerLogUtil.java
        │   ├── PropertiesUtil.java
        │   ├── RandomUtil.java
        │   └── SystemUtil.java
        └── **ws**
            └── WebSocketServer.java